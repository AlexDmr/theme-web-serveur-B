<!DOCTYPE html>
<html>
  <head>
    <link
      rel="stylesheet"
      href="https://localhost:8443/noCORS/style1.css"
      crossorigin="anonymous"
    />
    <script
      src="https://localhost:8443/noCORS/script1.js"
      crossorigin="anonymous"
    ></script>
    <script src="./index.js" defer></script>
    <script type="module">
      import { initializeApp } from "https://www.gstatic.com/firebasejs/9.1.3/firebase-app.js";
      import {
        getAuth,
        signOut,
        signInWithPopup,
        GoogleAuthProvider,
      } from "https://www.gstatic.com/firebasejs/9.1.3/firebase-auth.js";

      const firebaseConfig = {
        // Informations à trouver sur Firebase...
        apiKey: "AIzaSyDm-_cQDv1ZbTLbRfMAmZz8JUo9lL9mFfI",
        authDomain: "serveur-b.firebaseapp.com",
        projectId: "serveur-b",
        storageBucket: "serveur-b.appspot.com",
        messagingSenderId: "525603875308",
        appId: "1:525603875308:web:1e69194afe871ffef838c9",
      };
      const app = initializeApp(firebaseConfig);

      // Configuration du fournisseur d'authentification
      const provider = new GoogleAuthProvider();
      provider.setCustomParameters({ prompt: "select_account" });

      // Identification des éléments HTML qui nous intéresse
      const bt = document.querySelector("button"); // Le bouton
      const div = document.querySelector("#user"); // La div contenant les informations de l'utilisateur

      // Mise à jour de l'interface
      getAuth().onAuthStateChanged( update );
      update();

      // Fonction de mise à jour de l'interface
      async function update() {
        const auth = getAuth(app);
        console.log(auth); // Affichage de contrôle dans la console
        if (!!auth.currentUser) {
          // Cas où on a un utilisateur identifié
          bt.textContent = "Se déconnecter";
          bt.onclick = () => {
            signOut(getAuth())
          };
          const U = auth.currentUser;
          div.innerHTML = ` <p>Bonjour ${U.displayName}, votre email est bien ${U.email} ?</p>
                            <p>Votre photo de profil :
                              <img src="${U.photoURL}" />
                            </p>`;
        } else {
          // Cas où personne n'est encore identifié
          bt.textContent = "Connexion via Google";
          div.innerHTML = `Pas d'utilisateur authentifié`;
          bt.onclick = () =>
            signInWithPopup(auth, provider).catch(console.error);
        }
      }
    </script>
  </head>
  <body>
    <h1>Mon site B</h1>

    <section>
      <button>Identification via Google</button>

      <div id="user">chargement...</div>
    </section>

    <p>
      Une image via HTTPS venant d'un serveur A, sans CORS :
      <img src="https://localhost:8443/noCORS/tete.svg" />
    </p>

    <p>
      Une image via HTTPS venant du serveur A, avec CORS :
      <img src="https://localhost:8443/withCORS/tete.svg" />
    </p>

    <p>
      Une image via HTTP venant du serveur A, avec CORS :
      <img src="http://localhost:8080/withCORS/tete.svg" />
    </p>

    <p>
      Une image venant de
      <a
        href="https://cdn.pixabay.com/photo/2021/07/17/18/59/waterfall-6473754_1280.jpg"
        target="_blank"
      >
        https://cdn.pixabay.com/photo/2021/07/17/18/59/waterfall-6473754_1280.jpg
      </a>
      <img
        style="width: 320px"
        src="https://cdn.pixabay.com/photo/2021/07/17/18/59/waterfall-6473754_1280.jpg :"
      />
    </p>

    <hr />
    <p>Fetch d'une image via HTTP sans CORS : <button>GET</button></p>
    <p>Fetch d'une image via HTTP avec CORS : <button>GET</button></p>
    <p>Fetch d'une image via HTTPS sans CORS : <button>GET</button></p>
    <p>Fetch d'une image via HTTPS avec CORS : <button>GET</button></p>
  </body>
</html>
